CREATE TABLE app_user(user_id BIGINT PRIMARY KEY, display_name VARCHAR NOT NULL, email VARCHAR NOT NULL UNIQUE, "role" VARCHAR, department VARCHAR, is_active BOOLEAN DEFAULT(CAST('t' AS BOOLEAN)) NOT NULL, created_at TIMESTAMP DEFAULT(now()) NOT NULL, last_login TIMESTAMP);;
CREATE TABLE portfolio(portfolio_id BIGINT PRIMARY KEY, portfolio_name VARCHAR NOT NULL, managing_organization VARCHAR, portfolio_manager VARCHAR, is_active BOOLEAN DEFAULT(CAST('t' AS BOOLEAN)) NOT NULL, created_at TIMESTAMP DEFAULT(now()) NOT NULL, description VARCHAR, default_curve_type VARCHAR DEFAULT('linear'), default_alpha DECIMAL(5,2) DEFAULT(2.0), default_beta DECIMAL(5,2) DEFAULT(2.0), default_inflation_rate DECIMAL(5,3) DEFAULT(0.03), factor_1_name VARCHAR, factor_1_weight DECIMAL(5,2), factor_2_name VARCHAR, factor_2_weight DECIMAL(5,2), factor_3_name VARCHAR, factor_3_weight DECIMAL(5,2), factor_4_name VARCHAR, factor_4_weight DECIMAL(5,2), factor_5_name VARCHAR, factor_5_weight DECIMAL(5,2), factor_6_name VARCHAR, factor_6_weight DECIMAL(5,2), factor_7_name VARCHAR, factor_7_weight DECIMAL(5,2), factor_8_name VARCHAR, factor_8_weight DECIMAL(5,2), factor_9_name VARCHAR, factor_9_weight DECIMAL(5,2), factor_10_name VARCHAR, factor_10_weight DECIMAL(5,2), settings_json VARCHAR);;
CREATE TABLE sdg(sdg_id INTEGER PRIMARY KEY, sdg_name VARCHAR NOT NULL);;
CREATE TABLE portfolio_factor(factor_id BIGINT PRIMARY KEY, portfolio_id BIGINT NOT NULL, factor_name VARCHAR NOT NULL, factor_weight_percent DECIMAL(5,2) NOT NULL, likert_min INTEGER DEFAULT(1) NOT NULL, likert_max INTEGER DEFAULT(5) NOT NULL, is_active BOOLEAN DEFAULT(CAST('t' AS BOOLEAN)) NOT NULL, created_at TIMESTAMP DEFAULT(now()) NOT NULL, FOREIGN KEY (portfolio_id) REFERENCES portfolio(portfolio_id), UNIQUE(portfolio_id, factor_name));;
CREATE TABLE portfolio_ownership(portfolio_id BIGINT PRIMARY KEY, owner_user_id BIGINT NOT NULL, assigned_at TIMESTAMP DEFAULT(now()) NOT NULL, assigned_by VARCHAR, is_active BOOLEAN DEFAULT(CAST('t' AS BOOLEAN)), FOREIGN KEY (portfolio_id) REFERENCES portfolio(portfolio_id), FOREIGN KEY (owner_user_id) REFERENCES app_user(user_id));;
CREATE TABLE project(project_id BIGINT PRIMARY KEY, portfolio_id BIGINT NOT NULL, project_code VARCHAR, project_name VARCHAR NOT NULL, responsible_organization VARCHAR, project_manager VARCHAR, project_status VARCHAR DEFAULT('Ongoing') NOT NULL, initial_budget DECIMAL(18,2), current_budget DECIMAL(18,2), is_active BOOLEAN DEFAULT(CAST('t' AS BOOLEAN)) NOT NULL, created_at TIMESTAMP DEFAULT(now()) NOT NULL, budget_at_completion DECIMAL(18,2), planned_start_date DATE, planned_finish_date DATE, baseline_version INTEGER DEFAULT(0), baseline_approved_by VARCHAR, baseline_approved_date DATE, baseline_reason VARCHAR, curve_type VARCHAR, alpha DECIMAL(5,2), beta DECIMAL(5,2), inflation_rate DECIMAL(5,3), updated_at TIMESTAMP, FOREIGN KEY (portfolio_id) REFERENCES portfolio(portfolio_id));;
CREATE TABLE project_baseline(baseline_id BIGINT PRIMARY KEY, project_id BIGINT NOT NULL, portfolio_id BIGINT NOT NULL, baseline_version INTEGER NOT NULL, baseline_start_date DATE NOT NULL, baseline_end_date DATE, planned_start_date DATE, planned_finish_date DATE, budget_at_completion DECIMAL(18,2), project_status VARCHAR, baseline_reason VARCHAR, approved_by VARCHAR, approved_date DATE, created_at TIMESTAMP DEFAULT(now()) NOT NULL, is_active BOOLEAN DEFAULT(CAST('t' AS BOOLEAN)), FOREIGN KEY (project_id) REFERENCES project(project_id), FOREIGN KEY (portfolio_id) REFERENCES portfolio(portfolio_id), UNIQUE(project_id, baseline_version));;
CREATE TABLE project_factor_score(portfolio_id BIGINT NOT NULL, project_id BIGINT, factor_id BIGINT, score INTEGER NOT NULL, scored_at TIMESTAMP DEFAULT(now()) NOT NULL, scored_by_user_id BIGINT, is_active BOOLEAN DEFAULT(CAST('t' AS BOOLEAN)), FOREIGN KEY (project_id) REFERENCES project(project_id), FOREIGN KEY (scored_by_user_id) REFERENCES app_user(user_id), PRIMARY KEY(project_id, factor_id));;
CREATE TABLE project_sdg(portfolio_id BIGINT NOT NULL, project_id BIGINT, sdg_id INTEGER, weight_percent DECIMAL(5,2) DEFAULT(NULL), created_at TIMESTAMP DEFAULT(now()) NOT NULL, is_active BOOLEAN DEFAULT(CAST('t' AS BOOLEAN)), FOREIGN KEY (portfolio_id) REFERENCES portfolio(portfolio_id), FOREIGN KEY (project_id) REFERENCES project(project_id), FOREIGN KEY (sdg_id) REFERENCES sdg(sdg_id), PRIMARY KEY(project_id, sdg_id));;
CREATE TABLE project_status_report(status_report_id BIGINT PRIMARY KEY, portfolio_id BIGINT NOT NULL, project_id BIGINT NOT NULL, status_date DATE NOT NULL, actual_cost DECIMAL(18,2) DEFAULT(0) NOT NULL, planned_value DECIMAL(18,2), earned_value DECIMAL(18,2), notes VARCHAR, created_at TIMESTAMP DEFAULT(now()) NOT NULL, calculation_performed BOOLEAN DEFAULT(CAST('f' AS BOOLEAN)), calculation_timestamp TIMESTAMP, curve_type VARCHAR, alpha DECIMAL(5,2), beta DECIMAL(5,2), inflation_rate DECIMAL(5,3), actual_duration_months DECIMAL(10,2), original_duration_months DECIMAL(10,2), calculated_pv DECIMAL(18,2), calculated_ev DECIMAL(18,2), present_value DECIMAL(18,2), percent_complete DECIMAL(5,2), percent_budget_used DECIMAL(5,2), percent_time_used DECIMAL(5,2), percent_present_value_project DECIMAL(5,2), percent_likely_value_project DECIMAL(5,2), cv DECIMAL(18,2), cpi DECIMAL(10,3), eac DECIMAL(18,2), etc DECIMAL(18,2), vac DECIMAL(18,2), tcpi DECIMAL(10,3), sv DECIMAL(18,2), spi DECIMAL(10,3), es DECIMAL(10,2), espi DECIMAL(10,3), likely_duration DECIMAL(10,2), likely_completion DATE, planned_value_project DECIMAL(18,2), likely_value_project DECIMAL(18,2), ac DECIMAL(18,2), pv DECIMAL(18,2), ev DECIMAL(18,2), bac DECIMAL(18,2), plan_start_date DATE, plan_finish_date DATE, baseline_version INTEGER, likely_completion_date DATE, svt DECIMAL(10,2), is_active BOOLEAN DEFAULT(CAST('t' AS BOOLEAN)), FOREIGN KEY (portfolio_id) REFERENCES portfolio(portfolio_id), FOREIGN KEY (project_id) REFERENCES project(project_id), UNIQUE(project_id, status_date));;
CREATE INDEX idx_baseline_dates ON project_baseline(baseline_start_date, baseline_end_date);;
CREATE INDEX idx_baseline_portfolio ON project_baseline(portfolio_id);;
CREATE INDEX idx_baseline_project ON project_baseline(project_id);;
CREATE INDEX idx_factor_score_portfolio ON project_factor_score(portfolio_id);;
CREATE INDEX idx_factor_score_project ON project_factor_score(project_id);;
CREATE INDEX idx_project_sdg_portfolio ON project_sdg(portfolio_id);;
CREATE INDEX idx_project_sdg_project ON project_sdg(project_id);;
CREATE INDEX idx_project_sdg_sdg ON project_sdg(sdg_id);;
CREATE INDEX idx_psr_baseline_version ON project_status_report(baseline_version);;
CREATE INDEX idx_psr_portfolio ON project_status_report(portfolio_id, status_date);;
CREATE INDEX idx_psr_project_date ON project_status_report(project_id, status_date);;

